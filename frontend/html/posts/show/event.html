{% extends "posts/show/layout.html" %}
{% load static %}
{% load posts %}
{% load text_filters %}

{% block post %}
<div class="content">
    <div class="post post-type-post">
        <div class="post-header">
            <div class="post-info">
                {% if post.topic %}
                    {% include "posts/widgets/topic.html" with topic=post.topic type="post" %}
                {% endif %}
            </div>
            <div class="post-title">
                üìÖ {{ post.title | rutypography }}
            </div>
            <span class="post-is-public">
                {% if post.is_public %}
                    <i class="fas fa-globe-americas"></i>&nbsp;–ü—É–±–ª–∏—á–Ω—ã–π –∏–≤–µ–Ω—Ç
                {% else %}
                    <i class="fas fa-lock"></i>&nbsp;–¢–æ–ª—å–∫–æ –¥–ª—è —Å–≤–æ–∏—Ö
                {% endif %}
            </span>

            <div class="post-data">
                {% if post.deleted_at %}
                    <div class="post-label">
                        <span class="label label-type-deleted">
                            <span class="label-title">–£–¥–∞–ª—ë–Ω–Ω—ã–π –ø–æ—Å—Ç</span>
                        </span>
                    </div>
                {% elif not post.is_visible %}
                    <div class="post-label">
                        {% include "posts/widgets/draft_label.html" %}
                    </div>
                {% endif %}

                <div class="post-actions-line">
                    {% include "posts/widgets/post_actions_line.html" %}
                </div>

                {% if post.label %}
                    <div class="post-label">
                        {% include "posts/widgets/label.html" with label=post.label %}
                    </div>
                {% endif %}

                {% if post.image %}
                    <div class="post-image">
                        <img src="{{ post.image }}" alt="{{ post.title }}">
                    </div>
                {% endif %}
            </div>
        </div>

        <div class="block post-event">
            <div class="post-event-side">
                {% if post.metadata.event %}
                    <div class="post-event-date">
                        <div class="post-event-date-day">
                            {{ post.event_datetime|date:"d" }}
                        </div>
                        <div class="post-event-date-month">
                            {{ post.event_datetime|date:"E"|lower  }}
                        </div>
                    </div>
                {% endif %}
            </div>

            <div class="post-event-title">
                {{ post.event_datetime|date:"l" }}, –≤ {{ post.event_datetime|date:"H" }}:{{ post.event_datetime|date:"i" }} –ø–æ {% if post.metadata.event.timezone == "UTC" %}UTC{% else %}–ú–æ—Å–∫–≤–µ{% endif %}
            </div>

            <div class="post-event-location">
                {% if post.metadata.event.location %}
                    <i class="fas fa-map-marker-alt"></i>&nbsp;{{ post.metadata.event.location | urlize }}
                {% endif %}
            </div>

            <div class="post-event-calendar">
                –î–æ–±–∞–≤–∏—Ç—å –≤&nbsp;
                <a class="button button-small" href="{% url "generate_ical_invite" %}?title={{ post.title|urlencode }}&date={{ post.event_datetime|date:"c"|urlencode }}&timezone={{ post.metadata.event.timezone|urlencode }}{% if post.metadata.event.location %}&location={{ post.metadata.event.location|urlencode }}{% endif %}&url={{ settings.APP_HOST }}{% url "show_post" post.type post.slug %}" target="_blank"><i class="fab fa-apple"></i>&nbsp;Apple –ö–∞–ª–µ–Ω–¥–∞—Ä—å</a>
                <a class="button button-small" href="{% url "generate_google_invite" %}?title={{ post.title|urlencode }}&date={{ post.event_datetime|date:"c"|urlencode }}&timezone={{ post.metadata.event.timezone|urlencode }}{% if post.metadata.event.location %}&location={{ post.metadata.event.location|urlencode }}{% endif %}&url={{ settings.APP_HOST }}{% url "show_post" post.type post.slug %}" target="_blank"><i class="fab fa-google"></i>&nbsp;Google –ö–∞–ª–µ–Ω–¥–∞—Ä—å</a>
            </div>

            <div class="post-event-rsvp">
                {% if me %}
                    <post-rsvp
                        url="{% url "toggle_post_subscription" post.slug %}"
                        {% if subscription %}is-active-by-default{% endif %}
                    >
                    </post-rsvp>
                {% endif %}
            </div>
        </div>

        <div class="post-text">
            <post-upvote :initial-upvotes="{{ post.upvotes }}"
                         :hours-to-retract-vote="{{settings.RETRACT_VOTE_IN_HOURS}}"
                         upvote-url="{% url "upvote_post" post.slug %}"
                         retract-vote-url="{% url "retract_post_vote" post.slug %}"
                         {% if is_voted %}
                            initial-is-voted
                            initial-upvote-timestamp={{upvoted_at}}
                         {% endif %}
                         {% if not me|can_upvote:post or upvote_disabled %}is-disabled{% endif %}>
            </post-upvote>

            <div class="text-body text-body-type-post e-content">
                {% render_post post %}
            </div>
        </div>
        <div class="post-footer p-author">
            {% include "users/widgets/card.html" with user=post.author %}
        </div>
    </div>
    {% if linked_posts %}
        {% include "posts/widgets/linked_posts.html" %}
    {% endif %}
</div>
{% endblock %}
