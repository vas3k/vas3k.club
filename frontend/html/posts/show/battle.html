{% extends "posts/show/layout.html" %}
{% load static %}
{% load posts %}
{% load battle %}
{% load text_filters %}

{% block post %}
    <div class="battle-header">
        {% if post.topic %}
            <div class="battle-header-topic">
                {% include "posts/widgets/topic.html" with topic=post.topic type="post" %}
            </div>
        {% endif %}
    </div>
    <div class="battle-title-main">
        <div class="block battle-title p-name">
            <div class="battle-title-side-a">
                <div>{{ post.metadata.battle.sides.a.name | rutypography }}</div>
            </div>
            <div class="battle-title-vs">
                <div class="battle-title-vs-text">–∏–ª–∏</div>
            </div>
            <div class="battle-title-side-b">
                <div>{{ post.metadata.battle.sides.b.name | rutypography }}</div>
            </div>
        </div>

        <div class="post-date">
            <span class="post-is-public">
                {% if post.is_public %}
                    <i class="fas fa-globe-americas"></i>&nbsp;–ü—É–±–ª–∏—á–Ω—ã–π –ø–æ—Å—Ç&nbsp;&nbsp;&nbsp;
                {% else %}
                    <i class="fas fa-lock"></i>&nbsp;–¢–æ–ª—å–∫–æ –¥–ª—è —Å–≤–æ–∏—Ö&nbsp;&nbsp;&nbsp;
                {% endif %}
            </span>
            {{ post.effective_published_at|date:"j E Y" }}&nbsp;&nbsp;&nbsp;
            <i class="fas fa-eye"></i>&nbsp;{{ post.view_count }}&nbsp;&nbsp;&nbsp;
            {% if me %}
                <post-bookmark
                    bookmark-url="{% url "toggle_post_bookmark" post.slug %}"
                    {% if is_bookmark %}
                        initial-is-bookmarked
                    {% endif %}>
                </post-bookmark>
            {% endif %}
            {% if post.author == me or me.is_moderator %}
                <a href="{% url "edit_post" post.slug %}"><i class="fas fa-edit"></i>&nbsp;–ü—Ä–∞–≤–∏—Ç—å&nbsp;&nbsp;&nbsp;</a>
            {% endif %}
            {% include "posts/widgets/delete_restore.html" %}
            {% if me.is_moderator %}
                <a href="{% url "announce_post" post.slug %}"><i class="fas fa-bullhorn"></i></a>&nbsp;&nbsp;&nbsp;
                <a href="{% url "admin_post" post.slug %}"><i class="fas fa-tools"></i></a>
            {% endif %}
        </div>
    </div>

    <div class="content">
        {% if post.deleted_at %}
            <div class="post-label">
                <span class="label label-type-deleted">
                    <span class="label-title">–£–¥–∞–ª—ë–Ω–Ω—ã–π –ø–æ—Å—Ç</span>
                </span>
            </div>
        {% elif not post.is_visible %}
            <div class="post-label">
                <span class="label label-type-draft">
                    <span class="label-title">–ß–µ—Ä–Ω–æ–≤–∏–∫</span>
                </span>
            </div>
        {% endif %}

        <div class="block post post-layout-block post-type-battle">
            <div class="post-upvote">
                <post-upvote :initial-upvotes="{{ post.upvotes }}"
                             :hours-to-retract-vote="{{settings.RETRACT_VOTE_IN_HOURS}}"
                             upvote-url="{% url "upvote_post" post.slug %}"
                             retract-vote-url="{% url "retract_post_vote" post.slug %}"
                             {% if is_voted %}
                                initial-is-voted
                                initial-upvote-timestamp={{upvoted_at}}
                             {% endif %}
                             {% if not me|can_upvote:post or upvote_disabled %}is-disabled{% endif %}>
                </post-upvote>
                <div class="clearfix20"></div>
            </div>
            <div class="text-body text-body-layout-notitle text-body-type-post e-content">
                {% render_post post %}
            </div>
            <div class="post-footer">
                <div class="p-author">
                    {% include "users/widgets/small.html" with user=post.author created_at=post.created_at %}
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block comments %}
    <div class="post-comments" id="comments">
        {% if me %}
            <post-subscription
                url="{% url "toggle_post_subscription" post.slug %}"
                {% if subscription %}is-active-by-default{% endif %}
                class="post-comments-subscription"
                style="margin-left: 0;"
            >
            </post-subscription>
        {% endif %}

        {% battle_stats post comments %}

        {% if not post.comment_count and post.is_commentable and post.is_visible %}
            <div class="post-comments-title">
                <a href="#comments" class="post-comments-count">
                    –ê—Ä–≥—É–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ –ø–µ—Ä–≤—ã–º üëá
                </a>
            </div>
        {% endif %}

        {% if comments %}
            <div class="post-comments-list">
                {% include "comments/list.html" with comments=comments reply_form=reply_form type="battle" %}
            </div>
        {% endif %}

        {% if me and post.is_commentable and post.is_visible or me.is_moderator %}
            <div class="post-comments-form">
                {% include "comments/forms/battle.html" with post=post form=comment_form %}
            </div>
        {% endif %}
    </div>

    <div class="battle-etiquette">
        <strong>–≠—Ç–∏–∫–µ—Ç –±–∞—Ç–ª–æ–≤:</strong>
        <ul>
            <li>–ë–∞—Ç–ª ‚Äî —ç—Ç–æ —Å—Ö–≤–∞—Ç–∫–∞ –¥–≤—É—Ö –∫—Ä–∞–π–Ω–æ—Å—Ç–µ–π. –ú—ã –ø—ã—Ç–∞–µ–º—Å—è –≤—ã–¥–µ–ª–∏—Ç—å –∞—Ä–≥—É–º–µ–Ω—Ç—ã –∫–∞–∂–¥–æ–π –∏–∑ —Å—Ç–æ—Ä–æ–Ω —á—Ç–æ–±—ã –ø–æ—Ç–æ–º –ø–æ –Ω–∏–º —Å–æ—Å—Ç–∞–≤–∏—Ç—å —Å–≤–æ—é –∫–∞—Ä—Ç–∏–Ω—É –º–∏—Ä–∞. –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏–∑–±–µ–≥–∞—Ç—å –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ —Ç–∏–ø–∞ ¬´–∫–∞–∂–¥—ã–π —Ö–æ—Ä–æ—à –¥–ª—è —Å–≤–æ–µ–≥–æ¬ª.</li>
            <li>–û–¥–∏–Ω –∞—Ä–≥—É–º–µ–Ω—Ç ‚Äî –æ–¥–∏–Ω –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π. –ù–µ –¥–µ–ª–∞–π—Ç–µ —Å–ø–∏—Å–∫–æ–≤, —Ç–∞–∫ —Å–ª–æ–∂–Ω–µ–µ –≤–µ—Å—Ç–∏ –¥–∏—Å–∫—É—Å—Å–∏—é –∏ –ø–æ–¥—Å—á–∏—Ç—ã–≤–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É.</li>
            <li>–ú–æ–∂–Ω–æ —Ç–æ–ø–∏—Ç—å –∫–∞–∫ –∑–∞ –æ–¥–Ω—É, —Ç–∞–∫ –∏ –∑–∞ –æ–±–µ —Å—Ç–æ—Ä–æ–Ω—ã —Å—Ä–∞–∑—É. –ü—Ä–æ—Å—Ç–æ –≤—ã–±–µ—Ä–∏—Ç–µ –∑–∞ –∫–æ–≥–æ –≤—ã –ø—Ä–∏ –ø–æ—Å—Ç–∏–Ω–≥–µ.</li>
            <li>–ù–∞ –∞—Ä–≥—É–º–µ–Ω—Ç—ã –º–æ–∂–Ω–æ —Ä–µ–ø–ª–∞–∏—Ç—å. –†–µ–ø–ª–∞–∏ –Ω–∏–∫—É–¥–∞ –Ω–µ –∑–∞—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –∏ –Ω—É–∂–Ω—ã —Ç–æ–ª—å–∫–æ –¥–ª—è —Å—Ä–∞—á–∞.</li>
            <li>–ê–≤—Ç–æ—Ä–∞–º –±–∞—Ç–ª–æ–≤ —Ä–∞–∑—Ä–µ—à–µ–Ω–æ —É–¥–∞–ª—è—Ç—å –ø–æ–≤—Ç–æ—Ä—ã –∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –Ω–µ –ø–æ —Ñ–æ—Ä–º–∞—Ç—É.</li>
        </ul>
    </div>
{% endblock %}
