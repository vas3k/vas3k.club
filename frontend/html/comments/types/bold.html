{% load text_filters %}
{% load posts %}
{% load comments %}
<div class="block comment comment-layout-block" id="comment-{{ comment.id }}">
    <div class="comment-side">
        <a class="avatar comment-side-avatar" href="{% url "profile" comment.author.slug %}">
            <img src="{{ comment.author.get_avatar }}" alt="Аватар {{ comment.author.full_name }}" loading="lazy" />
        </a>
    </div>
    <div class="comment-header">
        <span class="comment-header-author">
            <a href="{% url "profile" comment.author.slug %}" class="comment-header-author-name">{{ comment.author.full_name }}</a><span class="comment-header-author-position">, {{ comment.author.position }}</span>
            {% if comment.author.hat %}{% include "users/widgets/hat.html" with hat=comment.author.hat %}{% endif %}
            {% if comment.author == post.author %}{% include "users/widgets/hat_author.html" %}{% endif %}
        </span>
        <a href="{% url "show_post" comment.post.type comment.post.slug %}#comment-{{ comment.id }}" class="comment-header-date">{{ comment.created_at | cool_date }}</a>
    </div>
    <div class="comment-rating">
        <comment-upvote :initial-upvotes="{{ comment.upvotes }}"
                         :hours-to-retract-vote="{{settings.RETRACT_VOTE_IN_HOURS}}"
                         upvote-url="{% url "upvote_comment" comment.id %}"
                         retract-vote-url="{% url "retract_comment_vote" comment.id %}"
                         {% if comment.is_voted %}
                            initial-is-voted
                            initial-upvote-timestamp="{{comment.upvoted_at}}"
                         {% endif %}
                         {% if not me|can_upvote:comment or upvote_disabled %}is-disabled{% endif %}>
        </comment-upvote>

        {% if comment.is_pinned %}
            <div class="comment-pinned-icon"><i class="fas fa-thumbtack"></i></div>
        {% endif %}
    </div>
    <div class="comment-body">
        <div class="text-body text-body-type-comment">
            {% render_comment comment %}
        </div>
    </div>
    <div class="comment-footer">
        {% include "comments/widgets/footer.html" with need_pin=True button_hidden_class="comment-button-hidden" need_reply=True comment_id=comment.id username=comment.author.slug %}
    </div>
</div>

<div class="clearfix"></div>

{% if replies %}
<div class="replies replies-indent-normal">
    {% for reply_tree in replies %}
        {% include "comments/types/reply.html" with comment=reply_tree.comment reply_to=reply_tree.comment replies=reply_tree.replies %}

        {% if post.is_commentable and me %}
            {% include "comments/forms/reply.html" with comment=reply_tree.comment reply_form=reply_form %}
        {% endif %}
    {% endfor %}
</div>
<div class="clearfix20"></div>
{% endif %}
