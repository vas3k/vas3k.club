{% extends "layout.html" %}
{% load static %}

{% block title %}
    –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è ‚Äî {{ block.super }}
{% endblock %}

{% block content %}
    <div class="content user-edit">
        <form action="." method="post" class="intro-form" enctype="multipart/form-data">
            {% csrf_token %}

            <div class="form-title">üòé<br>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è</div>

            {% if form.non_field_errors %}
                <div class="form-row form-row-center">
                    {% for error in form.non_field_errors %}
                        <span class="form-row-errors">{{ error }}</span>
                    {% endfor %}
                </div>
            {% endif %}

            <div class="block">
                <div class="form-row">
                    <label for="{{ form.full_name.id_for_label }}" class="form-label">
                        –ò–º—è
                    </label>
                    {{ form.full_name }}
                    {% if form.full_name.errors %}<span class="form-row-errors">{{ form.full_name.errors }}</span>{% endif %}
                    <span class="form-row-help">–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —É–∫–∞–∑—ã–≤–∞—Ç—å –∏–º—è + —Ñ–∞–º–∏–ª–∏—é, –ª–∏–±–æ –ø—Å–µ–≤–¥–æ–Ω–∏–º, –µ—Å–ª–∏ –≤–∞—Å –ª—É—á—à–µ –∑–Ω–∞—é—Ç –ø–æ –Ω–µ–º—É.</span>
                </div>

                <div class="form-row">
                    <label for="{{ form.country.id_for_label }}" class="form-label">
                        –°—Ç—Ä–∞–Ω–∞ –∏ –≥–æ—Ä–æ–¥
                    </label>
                    {{ form.country }} {{ form.city }}
                    {% if form.country.errors %}<span class="form-row-errors">{{ form.country.errors }}</span>{% endif %}
                    {% if form.city.errors %}<span class="form-row-errors">{{ form.city.errors }}</span>{% endif %}
                    <span class="form-row-help">–í–¥—Ä—É–≥ –º—ã —Ä–µ—à–∏–º —Å–æ–±—Ä–∞—Ç—å—Å—è –Ω–∞ –º–∏—Ç–∞–ø –∏–ª–∏ —Ç–∏–ø–∞ —Ç–æ–≥–æ.</span>
                </div>

                <div class="form-row">
                    <label for="{{ form.bio.id_for_label }}" class="form-label">
                        –°—Å—ã–ª–æ—á–∫–∏ –Ω–∞ —Å–µ–±—è –∏ –≤—Å—è–∫–æ–µ —Ç–∞–∫–æ–µ
                    </label>
                    {{ form.bio }}
                    {% if form.bio.errors %}<span class="form-row-errors">{{ form.bio.errors }}</span>{% endif %}
                    <span class="form-row-help">–ú–æ–∂–Ω–æ Markdown</span>
                </div>

                <div class="form-row">
                    <label for="{{ form.avatar.id_for_label }}" class="form-label">
                        –û–±–Ω–æ–≤–∏—Ç—å –∞–≤–∞—Ç–∞—Ä
                    </label>
                    {{ form.avatar }}
                    {% if form.avatar.errors %}<span class="form-row-errors">{{ form.avatar.errors }}</span>{% endif %}
                </div>

                <div class="form-row">
                    <label for="{{ form.company.id_for_label }}" class="form-label">
                        –ö–æ–º–ø–∞–Ω–∏—è
                    </label>
                    {{ form.company }}
                    {% if form.company.errors %}<span class="form-row-errors">{{ form.company.errors }}</span>{% endif %}
                </div>

                <div class="form-row">
                    <label for="{{ form.position.id_for_label }}" class="form-label">
                        –î–æ–ª–∂–Ω–æ—Å—Ç—å
                    </label>
                    {{ form.position }}
                    {% if form.position.errors %}<span class="form-row-errors">{{ form.position.errors }}</span>{% endif %}
                </div>
            </div>

            <div class="clearfix20"></div>

            <div class="block" id="digest-settings">
                <div class="block-header">üì´<br>–ö–∞–∫ —Ö–æ—Ç–∏—Ç–µ —Å–ª–µ–¥–∏—Ç—å –∑–∞ –Ω–æ–≤—ã–º–∏ –ø–æ—Å—Ç–∞–º–∏?</div>

                {% if not form.instance.is_email_verified %}<div class="error">–í—ã –ø–æ–∫–∞ –Ω–µ –ø–æ–¥—Ç–≤–µ—Ä–¥–∏–ª–∏ —Å–≤–æ–π –∞–¥—Ä–µ—Å —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–π –ø–æ—á—Ç—ã, —Ç–∞–∫ —á—Ç–æ –º—ã –Ω–µ –±—É–¥–µ–º —Å–ª–∞—Ç—å –Ω–∞ –Ω–µ–≥–æ —Ä–∞—Å—Å—ã–ª–∫–∏.</div>{% endif %}

                <div class="clearfix20"></div>

                <div class="form-row">
                    <div class="user-edit-digest">
                        <div class="user-edit-digest">
                            <label for="{{ form.email_digest_type.1.id_for_label }}" class="user-edit-digest-label">
                                <i class="fas fa-envelope-open"></i>
                                <span class="user-edit-digest-name">–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ<br> –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è + –∂—É—Ä–Ω–∞–ª</span>
                                {{  form.email_digest_type.1.tag }}
                            </label>
                            <label for="{{ form.email_digest_type.2.id_for_label }}" class="user-edit-digest-label">
                                <i class="fas fa-calendar-week"></i>
                                <span class="user-edit-digest-name">–¢–æ–ª—å–∫–æ –∂—É—Ä–Ω–∞–ª —Ä–∞–∑ –≤ –Ω–µ–¥–µ–ª—é</span>
                                {{  form.email_digest_type.2.tag }}
                            </label>
                            <label for="{{ form.email_digest_type.0.id_for_label }}" class="user-edit-digest-label">
                                <i class="fas fa-skull-crossbones"></i>
                                <span class="user-edit-digest-name">–ù–∏–∫–∞–∫ –Ω–µ —Ö–æ—á—É –≤–æ–æ–±—â–µ</span>
                                {{  form.email_digest_type.0.tag }}
                            </label>
                        </div>
                    </div>
                    {% if form.email_digest_type.errors %}<span class="form-row-errors">{{ form.email_digest_type.errors }}</span>{% endif %}
                </div>

                <div class="clearfix20"></div>

                <div class="block-description">
                    –ú–æ–∂–Ω–æ –µ—â–µ –ø–æ–¥–ø–∏—Å–∞—Ç—å—Å—è <a href="{{ settings.TELEGRAM_ONLINE_CHANNEL_URL }}" target="_blank">–Ω–∞ –∫–∞–Ω–∞–ª –ö–ª—É–±–∞</a> –∏–ª–∏ –∑–∞—Ö–æ–¥–∏—Ç—å –∫ –Ω–∞–º –≤ <a href="https://vas3k.ru/notes/club_chat/" target="_blank">—á–∞—Ç—ã</a>.
                </div>
            </div>

            <div class="clearfix50"></div>

            <div class="block">
                <div class="block-header">ü§ñ<br>–¢–µ–ª–µ–≥—Ä–∞–º-–±–æ—Ç</div>

                <div class="clearfix20"></div>

                <div class="block-description">
                    <p>
                        <strong>–ë–æ—Ç ‚Äî –≤–∞–∂–Ω–æ–µ –¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –∫ –ö–ª—É–±—É.</strong>
                        –û–Ω –æ–ø–æ–≤–µ—â–∞–µ—Ç –æ –Ω–æ–≤—ã—Ö –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è—Ö, —á–µ—Ä–µ–∑ –Ω–µ–≥–æ –º–æ–∂–Ω–æ –æ—Ç–≤–µ—á–∞—Ç—å –Ω–∞ –Ω–∏—Ö –∏ –¥–∞–∂–µ –ø–∏—Å–∞—Ç—å –ø–æ—Å—Ç—ã, —Ñ–æ—Ä–≤–∞—Ä–¥—è –µ–º—É —Å–æ–æ–±—â–µ–Ω–∏—è.
                    </p>

                    <p>
                        –ù–∞ –Ω–µ–≥–æ –∑–∞–≤—è–∑–∞–Ω–æ –º–Ω–æ–≥–æ —Ñ–∏—á –∏ –º—ã –æ—á–µ–Ω—å —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º –µ–≥–æ –ø–æ–¥–∫–ª—é—á–∏—Ç—å.
                    </p>

                    <p id="telegram-auth-data" style="font-weight: bold;">
                        {% if form.instance.telegram_id %}
                           –°–µ–π—á–∞—Å –ø—Ä–∏–≤—è–∑–∞–Ω –∞–∫–∫–∞—É–Ω—Ç: {{ form.instance.telegram_data.username }} ‚úÖ
                        {% endif %}
                    </p>

                    <p>
                        <script async src="https://telegram.org/js/telegram-widget.js?8" data-telegram-login="vas3k_club_bot" data-size="large" data-onauth="onTelegramAuth(user)" data-request-access="write"></script>
                        <script type="text/javascript">
                            function onTelegramAuth(user) {
                                fetch('{% url "link_telegram" %}?is_ajax=true', {
                                    method: 'POST',
                                    headers: {
                                        'Accept': 'application/json, text/plain, */*',
                                        'Content-Type': 'application/json'
                                    },
                                    credentials: "include",
                                    body: JSON.stringify(user)
                                })
                                .then((response) => {
                                    return response.json();
                                })
                                .then((data) => {
                                  if (data.status === "success") {
                                      document.getElementById("telegram-auth-data").innerHTML = "üòé –í—ã –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ã –∫–∞–∫: " + data.telegram.username;
                                      document.getElementById("telegram-auth-button").style.display = "none";
                                  } else {
                                      document.getElementById("telegram-auth-data").innerHTML = "–ß—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.";
                                  }
                                  document.getElementById("telegram-auth-data").style.display = "block";
                                });
                            }
                        </script>
                    </p>

                    <p>
                        ‚òùÔ∏è –ï—Å–ª–∏ –∫–Ω–æ–ø–∫–∏ —Å–≤–µ—Ä—Ö—É –Ω–µ –≤–∏–¥–Ω–æ, –∑–Ω–∞—á–∏—Ç —ç—Ç–æ –ª–∏–±–æ –≤–∞—à AdBlock, –ª–∏–±–æ –†–æ—Å–∫–æ–º–Ω–∞–¥–∑–æ—Ä –æ–ø—è—Ç—å –ª–æ–º–∞–µ—Ç –≤–∞–º –∏–Ω—Ç–µ—Ä–Ω–µ—Ç.
                    </p>
                </div>
            </div>

            <div class="clearfix50"></div>

            <button type="submit" class="button button-red">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
        </form>
    </div>
{% endblock %}
