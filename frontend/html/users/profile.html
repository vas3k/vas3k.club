{% extends "layout.html" %}
{% load static %}
{% load comments %}
{% load posts %}
{% load users %}
{% load text_filters %}
{% load paginator %}

{% block title %}
    {{ user.full_name }} ‚Äî {{ block.super }}
{% endblock %}

{% block og_tags %}
    <meta property="og:title" content="{{ user.full_name }} ‚Äî {{ settings.APP_NAME }}">
    <meta property="og:site_name" content="{{ settings.APP_NAME }}">
    <meta property="og:url" content="{{ settings.APP_HOST }}{% url "profile" user.slug %}">
    <meta property="og:type" content="website" />
    <meta property="og:description" content="{{ user.position }}{% if user.company %}, {{ user.company }}{% endif %}">
    <meta property="og:image" content="{{ user.get_avatar }}">

    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="{{ user.full_name }} ‚Äî {{ settings.APP_NAME }}">
    <meta name="twitter:description" content="{{ user.position }}{% if user.company %}, {{ user.company }}{% endif %}">
    <meta name="twitter:image" content="{{ user.get_avatar }}">

    <!-- Exclude profiles from search engines -->
    <meta name="robots" content="noindex">
{% endblock %}

{% block content %}
    <div class="content profile">
        {% if me.id == user.id or me.is_moderator %}
            <div class="profile-user-edit">
                {% if me.is_moderator %}
                    <i class="fas fa-tools"></i>&nbsp;<a href="{% url "admin_profile" user.slug %}">–ê–¥–º–∏–Ω–∫–∞</a>&nbsp;&nbsp;&nbsp;
                {% endif %}
                <i class="fas fa-cog"></i>&nbsp;<a href="{% url "profile_settings" user.slug %}">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è</a>
            </div>
        {% endif %}

        {% include "users/widgets/card.html" with user=user %}

        {% if me.id == user.id %}
            <div class="block profile-statuses">
                <div class="profile-status profile-respect">
                    <span class="profile-status-number">+{{ user.upvotes | cool_number }}</span>
                    <span class="profile-status-text">
                        {% if user.upvotes > 1000 %}
                            –ø–ª—é—Å–∏–∫–æ–≤
                        {% else %}
                            {{ user.upvotes | rupluralize:"–ø–ª—é—Å–∏–∫,–ø–ª—é—Å–∏–∫–∞,–ø–ª—é—Å–∏–∫–æ–≤" }}
                        {% endif %}
                    </span>
                </div>
                <a href="{% url "edit_payments" user.slug %}" class="profile-status">
                    {% if user.membership_days_left < 150 %}
                        <span class="profile-status-number">{% if user.membership_days_left < 10 %}üò±{% else %}üòã{% endif %} {{ user.membership_days_left | ceil | cool_number }}</span>
                        <span class="profile-status-text">{{ user.membership_days_left | ceil | rupluralize:"–¥–µ–Ω—å,–¥–Ω—è,–¥–Ω–µ–π" }}</span>
                    {% elif user.membership_days_left < 700 %}
                        <span class="profile-status-number">üòé {{ user.membership_days_left | days_to_months | cool_number  }}</span>
                        <span class="profile-status-text">{{ user.membership_days_left | days_to_months | rupluralize:"–º–µ—Å—è—Ü,–º–µ—Å—è—Ü–∞,–º–µ—Å—è—Ü–µ–≤" }}</span>
                    {% else %}
                        <span class="profile-status-number">üíé {{ user.membership_days_left | days_to_years | cool_number }}</span>
                        <span class="profile-status-text">{{ user.membership_days_left | days_to_years | rupluralize:"–≥–æ–¥,–≥–æ–¥–∞,–ª–µ—Ç" }}</span>
                    {% endif %}
                </a>
                <a href="{% url "edit_notifications" user.slug %}" class="profile-status">
                    <span class="profile-status-icon">üíå</span>
                    <span class="profile-status-status">
                        {% if user.is_email_unsubscribed %}
                            –í—ã –æ—Ç–ø–∏—Å–∞–Ω—ã –æ—Ç –≤—Å–µ—Ö –ø–∏—Å–µ–º üôÖ‚Äç‚ôÇÔ∏è
                        {% elif not user.is_email_verified %}
                            –í—ã –Ω–µ –ø–æ–¥—Ç–≤–µ—Ä–¥–∏–ª–∏ e-mail üö®
                        {% else %}
                            {% if user.email_digest_type == "daily" %}
                                –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –¥–∞–π–¥–∂–µ—Å—Ç üî•
                            {% elif user.email_digest_type == "weekly" %}
                                –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–π –∂—É—Ä–Ω–∞–ª üíé
                            {% else %}
                                –î–∞–π–¥–∂–µ—Å—Ç –∏ –∂—É—Ä–Ω–∞–ª –æ—Ç–∫–ª—é—á—ë–Ω—ã ‚ùå
                            {% endif %}
                        {% endif %}
                    </span>
                </a>
                <a href="{% url "edit_bot" user.slug %}" class="profile-status">
                    <span class="profile-status-icon">ü§ñ</span>
                    <span class="profile-status-status">
                        {% if user.telegram_id %}
                            ‚úÖ –ë–æ—Ç –∞–∫—Ç–∏–≤–µ–Ω
                        {% else %}
                            ‚ùå –ë–æ—Ç –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω
                        {% endif %}
                    </span>
                </a>
            </div>
        {% else %}
            <div class="block profile-statuses">
                <div class="profile-status profile-respect">
                    <span class="profile-status-number">+{{ user.upvotes | cool_number }}</span>
                    <span class="profile-status-text">
                        {% if user.upvotes > 1000 %}
                            –ø–ª—é—Å–∏–∫–æ–≤
                        {% else %}
                            {{ user.upvotes | rupluralize:"–ø–ª—é—Å–∏–∫,–ø–ª—é—Å–∏–∫–∞,–ø–ª—é—Å–∏–∫–æ–≤" }}
                        {% endif %}
                    </span>
                </div>
                <div class="profile-status">
                    {% if user.membership_created_days < 150 %}
                        <span class="profile-status-number">‚è≥ {{ user.membership_created_days | ceil | cool_number }}</span>
                        <span class="profile-status-text">{{ user.membership_created_days | ceil | rupluralize:"–¥–µ–Ω—å,–¥–Ω—è,–¥–Ω–µ–π" }} –≤ –ö–ª—É–±–µ</span>
                    {% elif user.membership_created_days < 700 %}
                        <span class="profile-status-number">‚è≥ {{ user.membership_created_days | days_to_months | cool_number  }}</span>
                        <span class="profile-status-text">{{ user.membership_created_days | days_to_months | rupluralize:"–º–µ—Å—è—Ü,–º–µ—Å—è—Ü–∞,–º–µ—Å—è—Ü–µ–≤" }} –≤ –ö–ª—É–±–µ</span>
                    {% else %}
                        <span class="profile-status-number">‚è≥ {{ user.membership_created_days | days_to_years | cool_number }}</span>
                        <span class="profile-status-text">{{ user.membership_created_days | days_to_years | rupluralize:"–≥–æ–¥,–≥–æ–¥–∞,–ª–µ—Ç" }} –≤ –ö–ª—É–±–µ</span>
                    {% endif %}
                </div>
                <friend-button
                    url="{% url "toggle_friend" user.slug %}"
                    {% if friend %}is-friend-by-default{% endif %}>
                </friend-button>
            </div>
        {% endif %}

        {% if badges %}
            <a class="user-badges" href="{% url "profile_badges" user.slug  %}">
                {% include "badges/widgets/badges.html" with badges=badges badge_size="big" %}
            </a>
        {% endif %}

        {% if intro %}
            <div class="block profile-intro">
                <div class="profile-header">
                    <a href="{% url "show_post" "intro" intro.slug %}">–ò–Ω—Ç—Ä–æ &rarr;</a>
                    {% if me.id == user.id %}
                        <a href="{% url "edit_post" intro.slug  %}" class="button post-edit-button profile-intro-edit">
                            <i class="fas fa-edit"></i>
                        </a>
                    {% endif %}
                </div>
                <div class="text-body profile-intro-text">
                    {% render_post intro %}
                </div>
                <div class="profile-intro-footer">
                    <a href="{% url "show_post" intro.type intro.slug %}#comments">
                        {{ intro.comment_count }} {{ intro.comment_count | rupluralize:"–∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π,–∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è,–∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤" }}
                    </a>
                </div>
            </div>
        {% endif %}

        {% if active_tags or me.id == user.id %}
            {% regroup tags by group_display as tag_groups %}
            {% for tag_group in tag_groups %}
                <div class="profile-header" id="tags_{{ tag_group.list.0.group }}">{{ tag_group.grouper }}</div>
                <div class="block profile-tags">
                    <div class="profile-tags-group">
                        <div class="user-tags">
                            {% for tag in tag_group.list %}
                                {% if me.id == user.id  %}
                                    <user-tag tag-name="{{ tag.name }}"
                                              tag-color="{{ tag.color }}"
                                              class="user-tag"
                                              url="{% url "toggle_tag" tag.code %}"
                                              {% if tag.code in active_tags %}is-active-by-default{% endif %}
                                    ></user-tag>
                                {% else %}
                                    {% if tag.code in active_tags %}
                                        <span class="user-tag user-tag-active" style="background-color: {{ tag.color  }};">{{ tag.name }}</span>
                                    {% endif %}
                                {% endif %}
                            {% endfor %}
                        </div>
                    </div>

                    {% if similarity %}
                        {% if tag_group.list.0.group == "personal" %}
                        <div class="profile-tags-footer">
                            –í—ã –ø–æ—Ö–æ–∂–∏ —Å —ç—Ç–∏–º —á–ª–µ–Ω–æ–º –∫–ª—É–±–∞ –Ω–∞ {{ similarity.personal|floatformat }}%
                        </div>
                        {% elif tag_group.list.0.group == "hobbies" %}
                        <div class="profile-tags-footer">
                            –í–∞—à–∏ —É–≤–ª–µ—á–µ–Ω–∏—è —Å–æ–≤–ø–∞–¥–∞—é—Ç –Ω–∞ {{ similarity.hobbies|floatformat }}%
                        </div>
                        {% endif %}
                    {% endif %}

                    {% if tag_group.list.0.group == "club" %}
                        <div class="profile-tags-footer">
                            {% if user.contact %}
                                <strong>–î–ª—è —Å–≤—è–∑–∏:</strong> {{ user.contact | urlize }}<br>
                                {% if user.id != me.id %}
                                    <small>–ù–µ –∑–∞–±—É–¥—å—Ç–µ —Å–∫–∞–∑–∞—Ç—å, —á—Ç–æ –≤—ã –∏–∑ –í–∞—Å—Ç—Ä–∏–∫.–ö–ª—É–±–∞</small>
                                {% endif %}
                            {% else %}
                                {% if user.id == me.id %}
                                    <strong>‚ö†Ô∏è –í—ã –Ω–µ —É–∫–∞–∑–∞–ª–∏ –∫–æ–Ω—Ç–∞–∫—Ç –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏.<br><a href="{% url "edit_profile" user.slug %}#id_contact">–°–¥–µ–ª–∞–π—Ç–µ —ç—Ç–æ –∑–¥–µ—Å—å</a></strong>
                                {% endif %}
                            {% endif %}

                            {% if user.id == me.id %}
                                <small><br>–î–ª—è –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã—Ö —Ç–µ–≥–æ–≤ —Ç–∏–ø–∞ ¬´–∏—â—É —Ä–∞–±–æ—Ç—É¬ª –∏–ª–∏ ¬´–º–æ–≥—É –Ω–∞—É—á–∏—Ç—å¬ª –Ω–µ –∑–∞–±—É–¥—å—Ç–µ —Ä–∞—Å—Å–∫–∞–∑–∞—Ç—å –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏ –≤ –∏–Ω—Ç—Ä–æ. –≠—Ç–æ –ø–æ–º–æ–∂–µ—Ç –¥—Ä—É–≥–∏–º –≤–∞—Å –Ω–∞–π—Ç–∏!</small>
                            {% endif %}
                        </div>
                    {% endif %}
                </div>
            {% endfor %}
        {% endif %}

        {% if achievements %}
            <div class="profile-header">–ê—á–∏–≤–∫–∏ –æ—Ç –ö–ª—É–±–∞</div>

            <div class="profile-achievements">
                <div class="user-achievements">
                    {% for achievement in achievements %}
                        <span class="user-achievement">
                            <span class="user-achievement-wrapper">
                                <div class="user-achievement-front" {% if achievement.style %}style="{{ achievement.style }}"{% endif %}>
                                    <img src="{{ achievement.image }}" class="user-badge-image" alt="{{ achievement.code }}">
                                    <span class="user-achievement-name">{{ achievement.name }}</span>
                                </div>
                                <div class="user-achievement-back" {% if achievement.style %}style="{{ achievement.style }}"{% endif %}>
                                    {{ achievement.description }}
                                </div>
                            </span>
                        </span>
                    {% endfor %}
                </div>
            </div>
        {% endif %}

        {% if projects %}
            <div class="profile-header">–ü—Ä–æ–µ–∫—Ç—ã</div>

            <div class="user-projects">
                {% for project in projects %}
                    <a href="{% url "show_post" project.type project.slug %}" class="block user-project">
                        {% if project.image %}
                            <img src="{{ project.image }}" alt="{{ project.title }}">
                        {% endif %}
                        <span class="user-project-title">{{ project.title }}</span>
                    </a>
                {% endfor %}
            </div>
        {% endif %}

        {% if comments %}
            <div class="profile-header">
                <a href="{% url "profile_comments" user.slug  %}">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ ({{ comments_total }}) &rarr;</a>
            </div>

            <div class="profile-comments">
                {% for comment in comments %}
                    {% include "comments/types/snippet.html" with comment=comment %}
                {% endfor %}
            </div>

            {% if comments_total > comments|length %}
                <div class="profile-more">
                    <a href="{% url "profile_comments" user.slug  %}" class="button button-inverted">–í—Å–µ {{ comments_total }} {{ comments_total|rupluralize:"–∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π,–∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è,–∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤" }}...</a>
                </div>
            {% endif %}
        {% endif %}

        {% if posts %}
            <div class="profile-header">
                <a href="{% url "profile_posts" user.slug  %}">–ü–æ—Å—Ç—ã ({{ posts_total }}) &rarr;</a>
            </div>

            <div class="profile-posts">
                {% for post in posts %}
                    {% include "posts/items/items.html" %}
                {% endfor %}
            </div>

            {% if posts_total > posts|length %}
                <div class="profile-more">
                    <a href="{% url "profile_posts" user.slug  %}" class="button button-inverted">–í—Å–µ {{ posts_total }} {{ posts_total|rupluralize:"–ø–æ—Å—Ç,–ø–æ—Å—Ç–∞,–ø–æ—Å—Ç–æ–≤" }}...</a>
                </div>
            {% endif %}
        {% endif %}
    </div>

    <user-expertise-window submit-form-action="{% url "add_expertise" %}"
                           :expertise-list="JSON.parse('{{ global_data.expertise | jsonify }}')"
                           v-show="shownWindow === 'add-expertise'"
                           @close-window="shownWindow = null">
    </user-expertise-window>
{% endblock %}
