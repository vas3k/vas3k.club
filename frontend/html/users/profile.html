{% extends "layout.html" %}
{% load static %}
{% load comments %}
{% load posts %}
{% load text_filters %}
{% load user_filters %}
{% load paginator %}

{% block title %}
    {{ user.slug }} ‚Äî {{ block.super }}
{% endblock %}

{% block og_tags %}
    <meta property="og:title" content="{{ user.slug }} ‚Äî {{ settings.APP_NAME }}">
    <meta property="og:site_name" content="{{ settings.APP_NAME }}">
    <meta property="og:url" content="{{ settings.APP_HOST }}">
    <meta property="og:type" content="website" />
    <meta property="og:description" content="{{ user.position }}{% if user.company %}, {{ user.company }}{% endif %}">
    <meta property="og:image" content="{% static "images/share.png" %}">

    <meta name="twitter:card" content="summary_image">
    <meta name="twitter:title" content="{{ user.slug }} ‚Äî {{ settings.APP_NAME }}">
    <meta name="twitter:description" content="{{ user.position }}{% if user.company %}, {{ user.company }}{% endif %}">
    <meta name="twitter:image" content="{% static "images/share.png" %}">
{% endblock %}


{% block content %}
    <div class="content profile">
        {% if me.id == user.id or me.is_moderator %}
            <div class="profile-user-edit">
                <a href="{% url "edit_profile" user.slug %}">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å</a>
                {% if me.is_moderator and not user.is_god %}
                    | <a href="{% url "admin_profile" user.slug %}">–ê–¥–º–∏–Ω–∫–∞</a>
                {% endif %}
            </div>
        {% endif %}

        {% include "users/widgets/card.html" with user=user %}

        {% if me.id == user.id %}
            <div class="block profile-numbers">
                <div class="profile-number profile-monies">
                    <div class="profile-monies-value">{% if user.is_god %}&infin;{% else %}üí∞{{ user.balance }}{% endif %}</div>
                    <div class="profile-monies-currency">–∫–∫/—Å–µ–∫</div>
                </div>
                <div class="profile-number profile-respect">
                    <div class="profile-respect-value">+{{ user.upvotes }}</div>
                    <div class="profile-respect-currency">{{ user.upvotes | rupluralize:"–ø–ª—é—Å–∏–∫,–ø–ª—é—Å–∏–∫–∞,–ø–ª—é—Å–∏–∫–æ–≤" }}</div>
                </div>
                <div class="profile-number profile-level">
                    <div class="profile-level-value">[–°–ö–û–†–û]</div>
                </div>
            </div>
        {% endif %}

        {% if intro or me.id == user.id %}
            <div class="block profile-intro">
                <div class="profile-header">
                    <a href="{% url "show_post" "intro" intro.slug %}">#intro &rarr;</a>
                    {% if me.id == user.id %}
                        <a href="{% url "edit_post" intro.slug  %}" class="button post-edit-button profile-intro-edit">
                            <i class="fas fa-edit"></i>
                        </a>
                    {% endif %}
                </div>
                {% if intro %}
                    <div class="text-body profile-intro-text">
                        {% render_post intro %}
                    </div>
                {% else %}
                    <div class="profile-add-button">
                        <a href="{% url "compose_type" "intro" %}" class="button profile-intro-create">–†–∞—Å—Å–∫–∞–∂–∏—Ç–µ –ö–ª—É–±—É –æ —Å–µ–±–µ</a>
                    </div>
                {% endif %}
            </div>
        {% endif %}

        {% if achievements %}
            <div class="profile-badges">
                <div class="profile-header">–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è</div>
                <div class="user-badges">
                    {% for achievement in achievements %}
                        <span class="user-badge" {% if achievement.style %}style="{{ achievement.style }}"{% endif %}>
                            <img src="{{ achievement.image }}" class="user-badge-image" alt="{{ achievement.type }}">
                            <span class="user-badge-name">{{ achievement.name }}</span>
                        </span>
                    {% endfor %}
                </div>
            </div>
        {% endif %}

        {% if active_tags or me.id == user.id %}
            {% regroup tags by group_display as tag_groups %}
            {% for tag_group in tag_groups %}
                <div class="profile-header">{{ tag_group.grouper }}</div>
                <div class="block profile-tags">
                    <div class="profile-tags-group">
                        <div class="user-tags">
                            {% for tag in tag_group.list %}
                                {% if me.id == user.id or tag.code in active_tags %}
                                    <user-tag :tag="JSON.parse('{{ tag.to_dict | jsonify }}')" url="{% url "toggle_tag" tag.code %}" {% if tag.code in active_tags %}is-active-by-default{% endif %}></user-tag>
                                {% endif %}
                            {% endfor %}
                        </div>
                    </div>
                </div>
            {% endfor %}
        {% endif %}

        {% if expertises or me.id == user.id %}
            <user-expertise
                :user-expertises="JSON.parse('{{ expertises | querySetToJson }}')"
                :global-expertises="JSON.parse('{{ global_data.expertise | jsonify }}')"
                submit-form-action="{% url "add_expertise" %}"
                {% if me.id == user.id %}is-user{% endif %}
                >
            </user-expertise>
        {% endif %}

        {% if projects or me.id == user.id %}
            <div class="profile-header">–ü—Ä–æ–µ–∫—Ç—ã</div>
            {% if projects %}
                <div class="user-projects">
                    {% for project in projects %}
                        <a href="{% url "show_post" project.type project.slug %}" class="block user-project">
                            {% if project.image %}
                                <img src="{{ project.image }}" alt="{{ project.title }}">
                            {% endif %}
                            <span class="user-project-title">{{ project.title }}</span>
                        </a>
                    {% endfor %}
                </div>
            {% else %}
                <div class="block">
                    <div class="profile-add-button">
                        <a href="{% url "compose_type" "project" %}" class="button">–†–∞—Å—Å–∫–∞–∂–∏—Ç–µ –Ω–∞–¥ —á–µ–º —Ä–∞–±–æ—Ç–∞–µ—Ç–µ</a>
                    </div>
                </div>
            {% endif %}
        {% endif %}

        {% if comments %}
            <div class="profile-comments">
                <div class="profile-header">–ü–æ—Å–ª–µ–¥–Ω–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏</div>
                {% for comment in comments %}
                    <div class="block comment comment-layout-normal" id="comment-{{ comment.id }}">
                        <div class="comment-header">
                            <div class="user user-small">
                                <span class="user-avatar">
                                    <span class="avatar" style="background-image: url('{{ comment.author.get_avatar }}');"></span>
                                </span>
                                <span class="user-info">
                                    {{ comment.post.title }}
                                </span>
                                <span class="user-footer">
                                    {{ comment.created_at | date:"j E Y" }}
                                </span>
                            </div>
                        </div>
                        <div class="comment-body">
                            <div class="text-body text-body-type-comment">
                                {% render_comment comment %}
                            </div>
                        </div>
                        <div class="comment-rating">
                            <span class="upvote upvote-type-small">{{ comment.upvotes }}</span>
                        </div>
                        <a class="block-link" href="{% url "show_post" comment.post.type comment.post.slug %}#comment-{{ comment.id }}"></a>
                    </div>
                {% endfor %}
            </div>
        {% endif %}

        {% if posts %}
            <div class="profile-posts">
                <div class="profile-header">–ü–æ—Å—Ç—ã</div>
                {% for post in posts %}
                    {% include "posts/items/items.html" %}
                {% endfor %}

                <div class="feed-paginator">
                    {% paginator posts %}
                </div>
            </div>
        {% endif %}
    </div>
{% endblock %}
