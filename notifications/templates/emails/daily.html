{% extends "emails/layout.html" %}
{% load text_filters %}
{% load comments %}
{% load users %}
{% load emails %}

{% block css %}
<style>
    h2 {
        text-align: center;
    }

    .events-list {
        list-style-type: none;
        padding-left: 10px;
        padding-top: 10px;
    }

        .events-item {
            padding-top: 10px;
            padding-bottom: 15px;
            display: block;
        }

    @media screen and (min-width: 600px) {
        .events-list {
            font-size: 20px;
        }
    }
</style>
{% endblock %}

{% block title %}
    {{ date|date:"d E Y" }}
{% endblock %}

{% block body %}
    <article>
        <p class="editorial">
            {% random_greeting %}, {{ user.full_name }}.
        </p>

        <p class="editorial">
            {% if moon_phase.club_day %}–°–µ–≥–æ–¥–Ω—è {{ moon_phase.club_day }} –¥–µ–Ω—å –æ—Ç —Å–æ—Ç–≤–æ—Ä–µ–Ω–∏—è –ö–ª—É–±–∞{% endif %}{% if moon_phase.phase_num %} –∏ {{ moon_phase.phase_num }}{% endif %}.
            {% if moon_phase.phase_sign %}{{ moon_phase.phase_sign | capfirst }}.{% endif %}
        </p>

        {% if moon_phase.phase_description %}
            <p class="editorial">
                {{ moon_phase.phase_description }}
            </p>
        {% endif %}

        <p class="editorial">
            –í–æ—Ç –ø–æ–¥–±–æ—Ä–∫–∞ —Å–∞–º—ã—Ö –≤–∞–∂–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π –≤ –ö–ª—É–±–µ –∑–∞ –¥–µ–Ω—å, —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ –¥–ª—è –≤–∞—Å üëá
        </p>

        {% if events %}
        <ul class="events-list">
            {% for event in events|slice:":10" %}
                {% if event.type == "my_post_comment" %}
                    <li class="events-item">üí≠ <strong>{{ event.count }} {{ event.count | rupluralize:"–Ω–æ–≤—ã–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π,–Ω–æ–≤—ã—Ö –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è,–Ω–æ–≤—ã—Ö –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤" }}</strong> –∫ –≤–∞—à–µ–º—É –ø–æ—Å—Ç—É ¬´<a href="{{ event.post_url }}?comment_order=-created_at#comments">{{ event.post_title }}</a>¬ª</li>
                {% elif event.type == "subscribed_post_comment" %}
                    <li class="events-item">‚òùÔ∏è <strong>{{ event.count }} {{ event.count | rupluralize:"–Ω–æ–≤—ã–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π,–Ω–æ–≤—ã—Ö –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è,–Ω–æ–≤—ã—Ö –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤" }}</strong> –∫ –ø–æ—Å—Ç—É ¬´<a href="{{ event.post_url }}?comment_order=-created_at#comments">{{ event.post_title }}</a>¬ª</li>
                {% elif event.type == "reply" %}
                    <li class="events-item">ü§ö <strong>{{ event.count }} {{ event.count | rupluralize:"–æ—Ç–≤–µ—Ç,–æ—Ç–≤–µ—Ç–∞,–æ—Ç–≤–µ—Ç–æ–≤" }}</strong> –Ω–∞ –≤–∞—à –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ –ø–æ—Å—Ç—É ¬´<a href="{{ event.post_url }}">{{ event.post_title }}</a>¬ª</li>
                {% elif event.type == "upvotes" %}
                    <li class="events-item">üíé –í—ã –ø–æ–ª—É—á–∏–ª–∏ <strong>{{ event.count }} {{ event.count | rupluralize:"–Ω–æ–≤—ã–π –ø–ª—é—Å–∏–∫,–Ω–æ–≤—ã—Ö –ø–ª—é—Å–∏–∫–∞,–Ω–æ–≤—ã—Ö –ø–ª—é—Å–∏–∫–æ–≤" }}</strong> –∑–∞ –ø–æ—Å—Ç—ã –∏ –∫–æ–º–º–µ–Ω—Ç—ã</li>
                {% endif %}
            {% endfor %}
        </ul>
        {% endif %}
    </article>

    {% if mentions %}
        <h2>üîî –í–∞—Å —É–ø–æ–º—è–Ω—É–ª–∏</h2>

        {% for comment in mentions|slice:":10" %}
            <article class="block comment">
                <span class="upvotes">
                    üëç{{ comment.upvotes }}
                </span>
                <div>
                    <a href="{{ settings.APP_HOST }}{% url "profile" comment.author.slug %}" style="text-decoration: none;">
                        <img src="{{ comment.author.get_avatar }}" alt="" width="24" height="24" class="avatar-small">
                        &nbsp;{{ comment.author.slug }}
                    </a>
                    –Ω–∞ {{ comment.post.prefix|default:"–ø–æ—Å—Ç"|lower }}
                    <a href="{% url "show_post" comment.post.type comment.post.slug %}#comment-{{ comment.id }}">{{ comment.post.title }}</a>
                </div>
                <div>
                    {% render_email comment %}
                </div>
            </article>
        {% endfor %}
    {% endif %}

    {% if posts %}
        <h2>üìù –°–≤–µ–∂–∏–µ –ø–æ—Å—Ç—ã</h2>

        {% for post in posts|slice:":5" %}

            <article class="block post">
                <span class="upvotes">
                    üëç{{ post.upvotes }}
                </span>

                <h3>
                    {% if post.type != "post" %}
                        {{ post.emoji }}
                    {% endif %}

                    {{ post.prefix }}

                    <a href="{{ settings.APP_HOST }}{% url "show_post" post.type post.slug %}" target="_blank">{{ post.title }}</a>

                    {% if post.label %}
                        &nbsp;{% include "posts/widgets/label.html" with label=post.label %}
                    {% endif %}
                </h3>

                <p>
                    {{ post.description | nl_to_p }}
                </p>

                <span class="post-footer">
                    <a href="{{ settings.APP_HOST }}{% url "profile" post.author.slug %}" style="text-decoration: none; color: #999;">
                        <img src="{{ post.author.get_avatar }}" alt="" width="24" height="24" class="avatar-small">
                        &nbsp;{{ post.author.slug }}
                    </a>
                    | {{ post.view_count }}&nbsp;{{ post.view_count | rupluralize:"–ø—Ä–æ—Å–º–æ—Ç—Ä,–ø—Ä–æ—Å–º–æ—Ç—Ä–∞,–ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤" }}
                    | {{ post.comment_count }}&nbsp;{{ post.comment_count | rupluralize:"–∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π,–∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è,–∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤" }}
                </span>
            </article>
        {% endfor %}

        {% if posts|slice:"5:" %}
            <p style="font-size: 19px; line-height: 1.4em;">–∏ –µ—â–µ <a href="{% url "feed_ordering" "all" "new" %}">{{ posts|slice:"5:"|length }} {{ posts|slice:"5:"|length|rupluralize:"–Ω–æ–≤—ã–π –ø–æ—Å—Ç,–Ω–æ–≤—ã—Ö –ø–æ—Å—Ç–∞,–Ω–æ–≤—ã—Ö –ø–æ—Å—Ç–æ–≤" }}</a>, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–∂–Ω–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –Ω–∞ –≥–ª–∞–≤–Ω–æ–π</p>
        {% endif %}
    {% endif %}

    {% if intros %}
        <h2>ü§ò –ù–æ–≤—ã–µ —É—á–∞—Å—Ç–Ω–∏–∫–∏</h2>

        <p style="font-size: 19px; line-height: 1.4em;">
            –ù–µ —Å—Ç–µ—Å–Ω—è–π—Ç–µ—Å—å –∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ –∏—Ö intro –∏ –∑–∞–¥–∞–≤–∞—Ç—å –∏–º –≤–æ–ø—Ä–æ—Å—ã. –î–ª—è —Ç–æ–≥–æ –æ–Ω–∏ –∏ –Ω—É–∂–Ω—ã :)
        </p>

        {% for intro in intros|slice:":1" %}
            <article class="block user">
                <div class="user-avatar">
                    <img src="{{ intro.author.get_avatar }}" alt="" width="50" height="50">
                </div>

                <div>
                    <h3>
                        <a href="{{ settings.APP_HOST }}{% url "profile" intro.author.slug %}" style="text-decoration: underline;">{{ intro.author.full_name }}</a> &nbsp;&nbsp;{% user_tag_images intro.author %}<br>
                        <span class="user-title-small">{{ intro.author.position }}{% if intro.author.company %} ‚Äî {{ intro.author.company }}{% endif %}</span>
                    </h3>

                    <p>{{ intro.description | truncatechars:350 | nl_to_p }}</p>

                    <span>
                        <a href="{{ settings.APP_HOST }}{% url "show_post" "intro" intro.slug %}">–ß–∏—Ç–∞—Ç—å –≤—Å—ë #intro &rarr;</a>
                    </span>
                </div>
            </article>
        {% endfor %}

        {% if intros|slice:"1:" %}
            <p style="font-size: 19px; line-height: 1.4em;">
                –∏ –¥—Ä—É–≥–∏–µ:
                {% for intro in intros|slice:"1:" %}
                    <a href="{% url "profile" intro.author.slug %}">{{ intro.author.slug }}</a>{% if not forloop.last %}, {% endif %}
                {% endfor %}
            </p>
        {% endif %}
    {% endif %}

    <br>

    <h2>–•–æ—Ä–æ—à–µ–≥–æ –¥–Ω—è ‚ù§Ô∏è</h2>

    <br><br><br>
{% endblock %}

{% block footer %}
    <p>
        –í—ã –≤—Å–µ–≥–¥–∞ –º–æ–∂–µ—Ç–µ <a href="{{ settings.APP_HOST }}/notifications/switch/nope/%user_id%/%secret_code%/">–æ—Ç–ø–∏—Å–∞—Ç—å—Å—è –æ—Ç —ç—Ç–∏—Ö –¥–∞–π–¥–∂–µ—Å—Ç–æ–≤</a> –∏–ª–∏ —Å–Ω–∏–∑–∏—Ç—å –∏—Ö –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ, –ø–µ—Ä–µ–π–¥—è –Ω–∞ <a href="{{ settings.APP_HOST }}/notifications/switch/weekly/%user_id%/%secret_code%/">–µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–π –∂—É—Ä–Ω–∞–ª</a>. –¢–æ–≥–¥–∞ –ø–∏—Å—å–º–∞ –±—É–¥—É—Ç –ø—Ä–∏—Ö–æ–¥–∏—Ç—å —Ä–µ–∂–µ, –Ω–æ –ª—É—á—à–µ.
    </p>
{% endblock %}
